{"name":"Lumen","tagline":"Open-source group discussion platform. Written in Ruby (Padrino), hosted via Heroku (web) and Virtualmin (email)","body":"okk# Lumen\r\n\r\n[![Build Status](https://travis-ci.org/wordsandwriting/lumen.png?branch=master)](https://travis-ci.org/wordsandwriting/lumen)\r\n[![Code Climate](https://codeclimate.com/github/wordsandwriting/lumen.png)](https://codeclimate.com/github/wordsandwriting/lumen)\r\n\r\n**For a live preview of Lumen, feel free to [request access to the previewers group on lumenapp.com](http://www.lumenapp.com/groups/previewers/request_membership).**\r\n\r\nLumen started life as a group discussion platform akin to [Google Groups](http://groups.google.com), [GroupServer](http://groupserver.org/), \r\n[Mailman](http://www.list.org/) or [Sympa](http://www.sympa.org/). Since then, it's gained some powerful extras. An outline of its features:\r\n\r\n* Open-source (under [Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-nc-sa/3.0/))\r\n* Hosted using dokku/Heroku (web app), a VPS (mail sever) and Amazon S3 (file attachments)\r\n* You can run dokku and the mail server on the same VPS\r\n* Designed for custom domains (group email addresses of the form yourgroup@yourdomain.org)\r\n* Sends and receives mail via regular SMTP and IMAP accounts\r\n* Dual web/email access\r\n* Extensible member profiles\r\n* Flexible digest engine\r\n* Events calendar\r\n* Daily summaries of news stories tweeted by group members via news.me integration\r\n* Maps placing people, organisations and venues\r\n* Google Docs integration\r\n* Facebook-style walls\r\n* Google Spreadsheets-like surveys feature\r\n\r\nLumen is written in Ruby using the [Padrino](http://padrinorb.com/) framework. It was originally created for the [New Economy Organisers Network](http://neweconomyorganisersnetwork.org/) (hosted by the [New Economics Foundation](http://neweconomics.org/)) who kindly agreed to open source the project and continue to sponsor its development.\r\n\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/top.jpg\">](http://wordsandwriting.github.io/lumen/images/top.jpg)\r\n\r\nSee below for more images.\r\n\r\n## How the mailing lists work, in brief\r\n\r\n1. Your mail server receives a mail to yourgroup@yourdomain.org\r\n2. The mail triggers a simple notification script on the mail server that in turn alerts your web app to the fact there's a new message for the group\r\n3. Your web app connects to the mail server via IMAP to fetch the new mail\r\n4. Your web app distributes the message to group members via SMTP\r\n\r\n## Getting up and running\r\n\r\n### 1. Register a domain\r\n\r\nWe'll add the DNS records shortly.\r\n\r\n###  2. Set up the mail server\r\n\r\nPurchase a VPS (Try [Digital Ocean](http://www.digitalocean.com) or [RamNode](http://www.ramnode.com/), 512mb RAM should do). If in doubt use `mail.yourdomain.org` as the hostname and choose Ubuntu 14.04 64-bit as your operating system.\r\nMake sure you obtain a password for the root user. (Since we're using password authentication, it's highly recommended that you install [fail2ban](https://www.liberiangeek.net/2014/10/install-configure-fail2ban-ubuntu-14-04-servers/).)\r\n\r\nFollow the guide on [How To Set Up a Postfix E-Mail Server with Dovecot](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-postfix-e-mail-server-with-dovecot) and\r\nthen the guide on [How To Install and Configure DKIM with Postfix](https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-dkim-with-postfix-on-debian-wheezy).\r\n\r\nAdd the following lines to `/etc/postfix/main.cf`:\r\n\r\n```\r\nvirtual_alias_domains = yourdomain.org\r\nvirtual_alias_maps = hash:/etc/postfix/virtual\r\nhome_mailbox = Maildir/\r\n```\r\n\r\nIn `/etc/dovecot/dovecot.conf`, change `mail_location = mbox:~/mail:INBOX=/var/mail/%u` to\r\n\r\n```\r\nmail_location = maildir:~/Maildir\r\n```\r\n\r\nIn `/etc/opendkim.conf`, add the line\r\n```\r\nSenderHeaders           Sender,From\r\n```\r\n\r\nRestart postfix, dovecot and opendkim.\r\n\r\n### 3. Set up the web app\r\n\r\nClone the Lumen repo and push it to dokku/Heroku.\r\n\r\nPrepare a MongoDB database: you can use [dokku-mongodb-plugin](https://github.com/jeffutter/dokku-mongodb-plugin) on dokku\r\nor [MongoLab](https://addons.heroku.com/mongolab) on Heroku.\r\n\r\nOptionally, add a custom domain (see instructions for [dokku](http://progrium.viewdocs.io/dokku/nginx) or [Heroku](https://devcenter.heroku.com/articles/custom-domains).)\r\n\r\nSet the following configuration variables:\r\n```\r\nAPP_NAME=yourappname DOMAIN=www.yourdomain.org MAIL_DOMAIN=yourdomain.org MONGO_URL=yourmongourl MAIL_SERVER_ADDRESS=yourmailserveraddress MAIL_SERVER_USERNAME=root MAIL_SERVER_PASSWORD=yourmailserverpassword S3_BUCKET_NAME=yourbucketname S3_ACCESS_KEY=youraccesskey S3_SECRET=yours3secret AIRBRAKE_HOST=yourairbrakehost AIRBRAKE_API_KEY=yourairbrakeapikey SESSION_SECRET=somelongsecretstring DRAGONFLY_SECRET=somelongsecretstring\r\n```\r\nIf using Heroku, also set `HEROKU_OAUTH_TOKEN` (see [https://github.com/heroku/platform-api](https://github.com/heroku/platform-api) for details of how to generate it).\r\n\r\nRun `rake languages:default[English,en]` to set a default language and `rake mi:create_indexes` to create the database indexes.\r\n\r\nSchedule the following tasks using [cron](https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps) (dokku) or the [Scheduler addon](https://devcenter.heroku.com/articles/scheduler) (Heroku):\r\n* `rake cleanup` (daily, 4am)\r\n* `rake news:update` (daily, suggested 7am)\r\n* `rake digests:daily` (daily, 8am)\r\n* `rake digests:weekly` (weekly, but you can schedule it daily and it will only run on Sunday)\r\n\r\nIf using dokku, your crontab should look something like this:\r\n```\r\n0 4 * * * dokku run yourappname rake cleanup\r\n0 7 * * * dokku run yourappname rake news:update\r\n0 8 * * * dokku run yourappname rake digests:daily\r\n0 0 * * 0 dokku run yourappname rake digests:weekly\r\n```\r\n\r\n### 4. Check DNS\r\n\r\n* For mail delivery `yourdomain.org MX mail.yourdomain.org` and `mail.yourdomain.org A {your VPS IP}`\r\n* SPF `yourdomain.org TXT \"v=spf1 a mx a:yourdomain.org ip4:{your VPS IP} ?all\"`\r\n* DKIM: see DKIM guide above\r\n\r\nIf using a custom domain with Heroku you'll also have something like `www.yourdomain.org CNAME yourappname.herokuapp.com`. \r\nYou can also make use of [wwwizer.com](http://wwwizer.com)'s free naked domain redirect `yourdomain.org A 174.129.25.170`.\r\n\r\n### 5. Configuration\r\n\r\nVisit www.yourdomain.org for the first time. (You should be automatically logged in as an administrator. If not, sign in with the email address 'admin@example.com' and the password 'lumen'.) Change the admin name, email address and password. Click 'Lumen configuration' in the footer and complete the configuration. You're done!\r\n\r\n## Switching mail servers\r\n\r\nIf you switch your mail server, you'll need to re-setup the group mail accounts on the new server. Fire up a console (`padrino c`) and run:\r\n```\r\nGroup.each { |group| group.setup_mail_accounts_and_forwarder }\r\nConversationPost.update_all(imap_uid: nil)\r\n```\r\n\r\n## Gallery\r\n\r\n### Homepage (amalgamates newsfeeds from all groups)\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/home.jpg\">](http://wordsandwriting.github.io/lumen/images/home.jpg)\r\n\r\n### Home calendar (amalgamates events from all groups)\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/calendar.jpg\">](http://wordsandwriting.github.io/lumen/images/calendar.jpg)\r\n\r\n### A group\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/group.jpg\">](http://wordsandwriting.github.io/lumen/images/group.jpg)\r\n\r\n### A group digest\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/digest.jpg\">](http://wordsandwriting.github.io/lumen/images/digest.jpg)\r\n\r\n### A group's map\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/map.jpg\">](http://wordsandwriting.github.io/lumen/images/map.jpg)\r\n\r\n### A profile \r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/profile.jpg\">](http://wordsandwriting.github.io/lumen/images/profile.jpg)\r\n\r\n### Email accounts corresponding to groups \r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/virtualmin.jpg\">](http://wordsandwriting.github.io/lumen/images/virtualmin.jpg)\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}