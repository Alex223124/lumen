{"name":"Lumen","tagline":"Open-source group discussion platform. Written in Ruby (Padrino), hosted via Heroku (web) and Virtualmin (email)","body":"# Lumen\r\n\r\n[![Build Status](https://travis-ci.org/wordsandwriting/lumen.png?branch=master)](https://travis-ci.org/wordsandwriting/lumen)\r\n[![Code Climate](https://codeclimate.com/github/wordsandwriting/lumen.png)](https://codeclimate.com/github/wordsandwriting/lumen)\r\n\r\nLumen started life as a group discussion platform akin to [Google Groups](http://groups.google.com), [GroupServer](http://groupserver.org/), \r\n[Mailman](http://www.list.org/) or [Sympa](http://www.sympa.org/). Since then, it's gained some powerful extras. An outline of its features:\r\n\r\n* Open-source (under [Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported](http://creativecommons.org/licenses/by-nc-sa/3.0/))\r\n* Hosted using Heroku (for the web interface, free in initial case), Amazon S3 (for file attachments, typically free or a few pennies per month) and Virtualmin (for the mail sever, requires a low-end VPS at a cost of a few pounds per month)\r\n* Designed for custom domains (group email addresses of the form yourgroup@yourdomain.org)\r\n* Sends and receives mail via regular SMTP and IMAP accounts on Virtualmin\r\n* Dual web/email access\r\n* Extensible member profiles\r\n* Flexible digest engine\r\n* Events calendar\r\n* Daily summaries of news stories tweeted by group members via news.me integration\r\n* Maps of people, organisations etc\r\n* Google Docs integration\r\n* Facebook style walls\r\n\r\nLumen is written in Ruby using the [Padrino](http://padrinorb.com/) framework. It was originally created for the [New Economy Organisers Network](http://neweconomyorganisersnetwork.org/) (hosted by the [New Economics Foundation](http://neweconomics.org/)) who kindly agreed to open source the project and continue to sponsor its development.\r\n\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/top.jpg\">](http://wordsandwriting.github.io/lumen/images/top.jpg)\r\n\r\nSee below for more images.\r\n\r\n## How the mailing lists work, in brief\r\n\r\n1. Your VPS (running Postfix/Virtualmin) receives a mail to yourgroup@yourdomain.org\r\n2. The mail triggers a simple notification script on the VPS that in turn alerts your Heroku app to the fact there's a new message for the group\r\n3. Your Heroku app connects to the VPS via IMAP to fetch the new mail\r\n4. Your Heroku app distributes the message to group members via SMTP\r\n\r\n## Getting up and running\r\n\r\n### 1. Register a domain\r\n\r\nWe'll add the DNS records shortly.\r\n\r\n###  2. Purchase a VPS and set up Virtualmin\r\n\r\nPurchase a VPS (check out [http://lowendbox.com/](http://lowendbox.com/), 512mb RAM should do). Use `mail.yourdomain.org` as the hostname and if in doubt choose CentOS 6 64-bit as your operating system. SSH into the VPS and install Virtualmin with:\r\n\r\n```\r\nwget http://software.virtualmin.com/gpl/scripts/install.sh\r\nchmod +x install.sh\r\n./install.sh\r\n```\r\n\r\nWhen the install is finished, visit https://{your VPS IP}:10000. Create a virtual server for yourdomain.org with an administration password set to the same as the Virtualmin user password. Go to 'Edit Users' an create a user no-reply@yourdomain.org with the same password again.\r\n\r\n### 3. Push code to Heroku\r\n\r\n```\r\ngit clone https://github.com/wordsandwriting/lumen.git\r\ncd lumen\r\nheroku create yourappname\r\ngit push heroku master\r\nheroku domains:add www.yourdomain.org\r\nheroku addons:add mongohq\r\nheroku addons:add papertrail\r\nheroku addons:add scheduler\r\nheroku config:set SESSION_SECRET=`rake secret`\r\nheroku config:set HEROKU_APP_NAME=yourappname\r\nheroku config:set HEROKU_API_KEY=yourapikey\r\nheroku config:set DOMAIN=www.yourdomain.org\r\nheroku config:set MAIL_DOMAIN=yourdomain.org\r\n```\r\n\r\n(You can find your Heroku API key at [http://dashboard.heroku.com/account](http://dashboard.heroku.com/account).)\r\n\r\n### 4. Set DNS\r\n\r\n* Point www. to Heroku `www.yourdomain.org CNAME yourappname.herokuapp.com`\r\n* Naked domain redirect via [wwwizer.com](http://wwwizer.com) `yourdomain.org A 174.129.25.170` \r\n* For mail delivery `yourdomain.org MX mail.yourdomain.org` and `mail.yourdomain.org A {your VPS IP}`\r\n* SPF `yourdomain.org TXT \"v=spf1 a mx a:yourdomain.org ip4:{your VPS IP} ?all\"`\r\n* DKIM: Visit Email Messages > DomainKeys Identified Mail in Virtualmin. Set 'Reject incoming email with invalid DKIM signature?' to 'No' and enter yourdomain.org to 'Additional domains to sign for'. Then add the record under 'DNS records for additional domains'.\r\n\r\n### 5. Configuration\r\n\r\nVisit www.yourdomain.org and change the admin name, email address and password. Click 'Lumen configuration' and complete the configuration.\r\n\r\n### 6. Rake tasks\r\n\r\nRun `heroku run rake mi:create_indexes` to create the database indexes. Open the Scheduler add-on with `heroku addons:open scheduler` and add the following tasks:\r\n```\r\nrake news:update 7am\r\nrake digests:daily 7.30am\r\nrake digests:weekly 11pm (only runs on Sunday)\r\nrake cleanup 4am\r\n```\r\n\r\n...and you're done!\r\n\r\n## Switching mail servers\r\n\r\nIf you switch your mail server, you'll need to re-setup the group mail accounts on the new server. Fire up a console (`heroku run bash; padrino c`) and run:\r\n```\r\nGroup.all.each { |g| g.setup_mail_accounts_and_forwarder }\r\nConversationPost.all.each { |c| c.update_attribute(:mid, nil) }\r\n```\r\n\r\n## Gallery\r\n\r\n### Homepage (amalgamates newsfeeds from all groups)\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/home.jpg\">](http://wordsandwriting.github.io/lumen/images/home.jpg)\r\n\r\n### Home calendar (amalgamates events from all groups)\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/calendar.jpg\">](http://wordsandwriting.github.io/lumen/images/calendar.jpg)\r\n\r\n### A group\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/group.jpg\">](http://wordsandwriting.github.io/lumen/images/group.jpg)\r\n\r\n### A group digest\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/digest.jpg\">](http://wordsandwriting.github.io/lumen/images/digest.jpg)\r\n\r\n### A group's map\r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/map.jpg\">](http://wordsandwriting.github.io/lumen/images/map.jpg)\r\n\r\n### A profile \r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/profile.jpg\">](http://wordsandwriting.github.io/lumen/images/profile.jpg)\r\n\r\n### Email accounts on Virtualmin corresponding to groups \r\n[<img src=\"http://wordsandwriting.github.io/lumen/images/virtualmin.jpg\">](http://wordsandwriting.github.io/lumen/images/virtualmin.jpg)\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}