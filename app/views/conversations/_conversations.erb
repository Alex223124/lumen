<h2><%=@group.slug%>'<%="s" unless @group.slug[-1] == 's' %> conversations</h2>

<div class="row">
  <div class="col-md-6">          
    <%= page_entries_info @conversations, :model => 'Conversation' %>
  </div>
  <div class="col-md-offset-2 col-md-4" style="text-align: right;">
    <% form_tag '',  :id => 'conversations-search-form', :style => "display: inline", :method => 'get' do %>      
      <div class="input-group" style="text-align: right">
        <%= search_field_tag :q, :class => 'form-control', :value => @q %>
        <span class="input-group-btn">
          <button class="btn btn-default" type="button"><i class="fa fa-search"></i></button>
        </span>            
      </div>            
    <% end %> 
    <script>
      $(function() {
        $('#conversations-search-form').submit(function(e) {
          $('#conversations-tab').load("/groups/<%=@group.slug%>/conversations?" + $(this).serialize());
          return false;
        });
      });
    </script>    
  </div>
</div>

<%= partial :'conversations/conversations_table', :locals => {:conversations => @conversations}  %>

<script>
  $(function() {
    $('#conversations-tab .pagination a').click(function(e) {
      e.preventDefault();
      if ($(this).attr('href') != '#')
        $('#conversations-tab').load($(this).attr('href'));
    });
  });
</script>
<%= will_paginate @conversations, :renderer => WillPaginate::ViewHelpers::BootstrapRenderer %>

<% if @membership %>
  <h4>New conversation</h4>

  <p>Fill out the form below or send an email to <a href="mailto:<%=@group.email%>"><%=@group.email%></a></p>
  <div class="media">
    <span class="pull-left">
      <img class="media-object" style="width: 32px" src="<%=current_account.picture ? current_account.picture.thumb('32x32#').url : '/images/silhouette.png' %>">
    </span>
    <div class="media-body">
      <% form_tag "/groups/#{@group.slug}/new_conversation", :multipart => true do |f| %>
        <label class="sr-only" for="conversation_subject">Subject</label>
        <%= text_field_tag :subject, :class => 'form-control', :id => 'conversation_subject', :placeholder => 'Subject', :style => 'margin-bottom: 10px; width: 15em;' %>
        <label class="sr-only" for="conversation_body">Body</label>
        <%= text_area_tag :body, :class => 'wysiwyg form-control', :id => 'conversation_body', :style => 'display: block;' %>
        <div style="margin-top: 10px">
          <a class="btn btn-default" href="javascript:;" onclick="$(this).hide();
                  $('#attach').show();
                  $('#attach input').click();">Attach a file</a>
          <div style="display:none; margin-bottom: 10px" id="attach">
            <%= file_field_tag :attachment %>
          </div>            
          <button type="submit" class="btn btn-default">Post</button>          
        </div>        
      <% end %> 
    </div>
  </div>
<% end %>