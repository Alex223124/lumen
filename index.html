<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lumen by wordsandwriting</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Lumen</h1>
        <p>Open-source group discussion platform. Written in Ruby (Padrino), hosted via Heroku (web) and Virtualmin (email)</p>

        <p class="view"><a href="https://github.com/wordsandwriting/lumen">View the Project on GitHub <small>wordsandwriting/lumen</small></a></p>


        <ul>
          <li><a href="https://github.com/wordsandwriting/lumen/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="lumen" class="anchor" href="#lumen"><span class="octicon octicon-link"></span></a>Lumen</h1>

<p>Lumen started life as a group discussion platform akin to <a href="http://groups.google.com">Google Groups</a>, <a href="http://groupserver.org/">GroupServer</a>, 
<a href="http://www.list.org/">Mailman</a> or <a href="http://www.sympa.org/">Sympa</a>. Since then, it's gained some powerful extras. An outline of its features:</p>

<ul>
<li>Open-source</li>
<li>Self-hosted using Heroku (for the web interface, free in initial case), Amazon S3 (for file attachments, typically free or a few pennies/cents per month) and Virtualmin (for the mail sever, requires a low-end VPS at a cost of around £20/$40 per year)</li>
<li>Designed for custom domains (group email addresses of the form <a href="mailto:yourgroup@yourdomain.org">yourgroup@yourdomain.org</a>)</li>
<li>Sends and receives mail via regular SMTP and IMAP accounts on Virtualmin</li>
<li>Dual web/email access</li>
<li>Extensible member profiles</li>
<li>Flexible digest engine</li>
<li>Events calendar</li>
<li>Daily summaries of news stories tweeted by group members via news.me integration</li>
<li>Geographically-aware lists feature for maintaining lists of venues, contacts etc</li>
</ul><p>Lumen is written in Ruby using the <a href="http://padrinorb.com/">Padrino</a> framework.</p>

<p><a href="http://wordsandwriting.github.io/lumen/images/top.jpg"><img src="http://wordsandwriting.github.io/lumen/images/top.jpg"></a></p>

<p>See below for more images.</p>

<h2>
<a name="getting-up-and-running" class="anchor" href="#getting-up-and-running"><span class="octicon octicon-link"></span></a>Getting up and running</h2>

<h3>
<a name="1-register-a-domain" class="anchor" href="#1-register-a-domain"><span class="octicon octicon-link"></span></a>1. Register a domain</h3>

<p>We'll add the DNS records shortly.</p>

<h3>
<a name="2-push-code-to-heroku" class="anchor" href="#2-push-code-to-heroku"><span class="octicon octicon-link"></span></a>2. Push code to Heroku</h3>

<pre><code>git clone https://github.com/wordsandwriting/lumen.git
cd lumen
heroku create yourappname
git push heroku master
heroku addons:add mongohq
heroku addons:add memcachier
heroku addons:add papertrail
heroku addons:add scheduler
heroku config:set HEROKU_APP_NAME=yourappname
heroku config:set HEROKU_API_KEY=yourapikey
</code></pre>

<p>(You can find your Heroku API key at <a href="http://dashboard.heroku.com/account">http://dashboard.heroku.com/account</a>.)</p>

<h3>
<a name="3-set-up-virtualmin" class="anchor" href="#3-set-up-virtualmin"><span class="octicon octicon-link"></span></a>3. Set up Virtualmin</h3>

<p>Purchase a VPS (check out <a href="http://lowendbox.com/">http://lowendbox.com/</a>, 512mb RAM should do) and follow <a href="http://lowendbox.com/blog/your-own-mail-server-with-virtualmin/">this guide</a> to set up Virtualmin. 
You probably don't need ClamAV or SpamAssassin, and so you can untick Spam and Virus filtering from the 'Features and Plugins' screen.</p>

<p>Create an email address <a href="mailto:no-reply@yourdomain.org">no-reply@yourdomain.org</a> with the same password as the Virtualmin user.</p>

<h3>
<a name="4-set-dns" class="anchor" href="#4-set-dns"><span class="octicon octicon-link"></span></a>4. Set DNS</h3>

<p>Supposing the IP of your VPS is 11.22.33.44:</p>

<ul>
<li>Point <a href="http://www">www</a>. to Heroku <code>www.yourdomain.org CNAME yourappname.herokuapp.com</code>
</li>
<li>Naked domain redirect via <a href="http://wwwizer.com">wwwizer.com</a> <code>yourdomain.org A 174.129.25.170</code> </li>
<li>For mail delivery <code>yourdomain.org MX mail.yourdomain.org</code> and <code>mail.yourdomain.org A 11.22.33.44</code>
</li>
<li>SPF <code>yourdomain.org TXT "v=spf1 a mx a:yourdomain.org ip4:11.22.33.44 ?all"</code>
</li>
<li>DKIM: Visit Email Messages &gt; DomainKeys Identified Mail in Virtualmin. Set 'Reject incoming email with invalid DKIM signature?' to 'No' and enter yourdomain.org to 'Additional domains to sign for'. Then add the record under 'DNS records for additional domains'.</li>
</ul><h3>
<a name="5-configuration" class="anchor" href="#5-configuration"><span class="octicon octicon-link"></span></a>5. Configuration</h3>

<p>Visit <a href="http://www.yourdomain.org">www.yourdomain.org</a> and complete the configuration (don't forget your S3 details).</p>

<p>You can find an example notification script (VIRTUALMIN_NOTIFICATION_SCRIPT) in <code>/notify</code>. Visit <a href="http://www.yourdomain.org/admin/index/Account">http://www.yourdomain.org/admin/index/Account</a> and click 'Edit' to
find your secret token.</p>

<h3>
<a name="6-rake-tasks" class="anchor" href="#6-rake-tasks"><span class="octicon octicon-link"></span></a>6. Rake tasks</h3>

<pre><code>heroku run rake mi:create_indexes
heroku addons:open scheduler
</code></pre>

<p>Add the following tasks to the scheduler:</p>

<pre><code>rake news:update 7am
rake digests:daily 7.30am
rake digests:weekly 11pm (only runs on Sunday)
rake cleanup 4am
</code></pre>

<h2>
<a name="switching-mail-servers" class="anchor" href="#switching-mail-servers"><span class="octicon octicon-link"></span></a>Switching mail servers</h2>

<p>If you switch your mail server, you'll need to re-setup the group mail accounts on the new server. Fire up a console (<code>heroku run bash; padrino c</code>) and run:</p>

<pre><code>Group.all.each { |g| g.setup_mail_accounts_and_forwarder }
ConversationPost.all.each { |c| c.update_attribute(:mid, nil) }
</code></pre>

<h2>
<a name="gallery" class="anchor" href="#gallery"><span class="octicon octicon-link"></span></a> Gallery</h2>

<h3>
<a name="homepage-amalgamates-newsfeeds-from-all-groups" class="anchor" href="#homepage-amalgamates-newsfeeds-from-all-groups"><span class="octicon octicon-link"></span></a>Homepage (amalgamates newsfeeds from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/home.jpg"><img src="http://wordsandwriting.github.io/lumen/images/home.jpg"></a></p>

<h3>
<a name="home-calendar-amalgamates-events-from-all-groups" class="anchor" href="#home-calendar-amalgamates-events-from-all-groups"><span class="octicon octicon-link"></span></a>Home calendar (amalgamates events from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/calendar.jpg"><img src="http://wordsandwriting.github.io/lumen/images/calendar.jpg"></a></p>

<h3>
<a name="a-group" class="anchor" href="#a-group"><span class="octicon octicon-link"></span></a>A group</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/group.jpg"><img src="http://wordsandwriting.github.io/lumen/images/group.jpg"></a></p>

<h3>
<a name="a-group-digest" class="anchor" href="#a-group-digest"><span class="octicon octicon-link"></span></a>A group digest</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/digest.jpg"><img src="http://wordsandwriting.github.io/lumen/images/digest.jpg"></a></p>

<h3>
<a name="a-groups-map" class="anchor" href="#a-groups-map"><span class="octicon octicon-link"></span></a>A group's map</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/map.jpg"><img src="http://wordsandwriting.github.io/lumen/images/map.jpg"></a></p>

<h3>
<a name="a-list" class="anchor" href="#a-list"><span class="octicon octicon-link"></span></a>A list</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/list.jpg"><img src="http://wordsandwriting.github.io/lumen/images/list.jpg"></a></p>

<h3>
<a name="a-profile" class="anchor" href="#a-profile"><span class="octicon octicon-link"></span></a>A profile</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/profile.jpg"><img src="http://wordsandwriting.github.io/lumen/images/profile.jpg"></a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/wordsandwriting">wordsandwriting</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>