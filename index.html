<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lumen by wordsandwriting</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Lumen</h1>
        <p>Open-source group discussion platform. Written in Ruby (Padrino), hosted via Heroku (web) and Virtualmin (email)</p>

        <p class="view"><a href="https://github.com/wordsandwriting/lumen">View the Project on GitHub <small>wordsandwriting/lumen</small></a></p>


        <ul>
          <li><a href="https://github.com/wordsandwriting/lumen/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/wordsandwriting/lumen">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="lumen" class="anchor" href="#lumen"><span class="octicon octicon-link"></span></a>Lumen</h1>

<p><a href="https://travis-ci.org/wordsandwriting/lumen"><img src="https://travis-ci.org/wordsandwriting/lumen.png?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/wordsandwriting/lumen"><img src="https://codeclimate.com/github/wordsandwriting/lumen.png" alt="Code Climate"></a></p>

<p><strong>For a live preview of Lumen, feel free to <a href="http://www.lumenapp.com/groups/previewers/request_membership">request access to the previewers group on lumenapp.com</a>.</strong></p>

<p>Lumen started life as a group discussion platform akin to <a href="http://groups.google.com">Google Groups</a>, <a href="http://groupserver.org/">GroupServer</a>, 
<a href="http://www.list.org/">Mailman</a> or <a href="http://www.sympa.org/">Sympa</a>. Since then, it's gained some powerful extras. An outline of its features:</p>

<ul>
<li>Open-source (under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>)</li>
<li>Hosted using Heroku (for the web interface, free in initial case), Amazon S3 (for file attachments, typically free or a few pennies per month) and Virtualmin (for the mail sever, requires a low-end VPS at a cost of a few pounds per month)</li>
<li>Designed for custom domains (group email addresses of the form <a href="mailto:yourgroup@yourdomain.org">yourgroup@yourdomain.org</a>)</li>
<li>Sends and receives mail via regular SMTP and IMAP accounts on Virtualmin</li>
<li>Dual web/email access</li>
<li>Extensible member profiles</li>
<li>Flexible digest engine</li>
<li>Events calendar</li>
<li>Daily summaries of news stories tweeted by group members via news.me integration</li>
<li>Maps placing people, organisations and venues</li>
<li>Google Docs integration</li>
<li>Facebook-style walls</li>
<li>Google Spreadsheets-like surveys feature</li>
</ul><p>Lumen is written in Ruby using the <a href="http://padrinorb.com/">Padrino</a> framework. It was originally created for the <a href="http://neweconomyorganisersnetwork.org/">New Economy Organisers Network</a> (hosted by the <a href="http://neweconomics.org/">New Economics Foundation</a>) who kindly agreed to open source the project and continue to sponsor its development.</p>

<p><a href="http://wordsandwriting.github.io/lumen/images/top.jpg"><img src="http://wordsandwriting.github.io/lumen/images/top.jpg"></a></p>

<p>See below for more images.</p>

<h2>
<a name="how-the-mailing-lists-work-in-brief" class="anchor" href="#how-the-mailing-lists-work-in-brief"><span class="octicon octicon-link"></span></a> How the mailing lists work, in brief</h2>

<ol>
<li>Your VPS (running Postfix/Virtualmin) receives a mail to <a href="mailto:yourgroup@yourdomain.org">yourgroup@yourdomain.org</a>
</li>
<li>The mail triggers a simple notification script on the VPS that in turn alerts your Heroku app to the fact there's a new message for the group</li>
<li>Your Heroku app connects to the VPS via IMAP to fetch the new mail</li>
<li>Your Heroku app distributes the message to group members via SMTP</li>
</ol><h2>
<a name="getting-up-and-running" class="anchor" href="#getting-up-and-running"><span class="octicon octicon-link"></span></a>Getting up and running</h2>

<h3>
<a name="1-register-a-domain" class="anchor" href="#1-register-a-domain"><span class="octicon octicon-link"></span></a>1. Register a domain</h3>

<p>We'll add the DNS records shortly.</p>

<h3>
<a name="2-purchase-a-vps-and-set-up-virtualmin" class="anchor" href="#2-purchase-a-vps-and-set-up-virtualmin"><span class="octicon octicon-link"></span></a>2. Purchase a VPS and set up Virtualmin</h3>

<p>Purchase a VPS (Try <a href="http://www.ramnode.com/">RamNode</a> or <a href="http://www.digitalocean.com">Digital Ocean</a>, 512mb RAM should do). Use <code>mail.yourdomain.org</code> as the hostname and if in doubt choose CentOS 6 64-bit as your operating system. SSH into the VPS and install Virtualmin with:</p>

<pre><code>wget http://software.virtualmin.com/gpl/scripts/install.sh
chmod +x install.sh
./install.sh
</code></pre>

<p>When the install is finished, visit https://{your VPS IP}:10000. Create a virtual server for yourdomain.org with an administration password set to the same as the Virtualmin user password. Go to 'Edit Users' an create a user <a href="mailto:no-reply@yourdomain.org">no-reply@yourdomain.org</a> with the same password again.</p>

<h3>
<a name="3-push-code-to-heroku" class="anchor" href="#3-push-code-to-heroku"><span class="octicon octicon-link"></span></a>3. Push code to Heroku</h3>

<pre><code>git clone https://github.com/wordsandwriting/lumen.git
cd lumen
heroku create yourappname
git push heroku master
heroku domains:add www.yourdomain.org
heroku addons:add mongohq
heroku addons:add papertrail
heroku addons:add scheduler
heroku config:set SESSION_SECRET=`rake secret`
heroku config:set DRAGONFLY_SECRET=`rake secret`
heroku config:set APP_NAME=yourappname
heroku config:set HEROKU_OAUTH_TOKEN=youroauthtoken
heroku config:set DOMAIN=www.yourdomain.org
heroku config:set MAIL_DOMAIN=yourdomain.org
git push yourappname master
</code></pre>

<p>(See <a href="https://github.com/heroku/platform-api">https://github.com/heroku/platform-api</a> for details of how to generate your Heroku OAuth token.)</p>

<h3>
<a name="4-set-dns" class="anchor" href="#4-set-dns"><span class="octicon octicon-link"></span></a>4. Set DNS</h3>

<ul>
<li>Point <a href="http://www">www</a>. to Heroku <code>www.yourdomain.org CNAME yourappname.herokuapp.com</code>
</li>
<li>Naked domain redirect via <a href="http://wwwizer.com">wwwizer.com</a> <code>yourdomain.org A 174.129.25.170</code> </li>
<li>For mail delivery <code>yourdomain.org MX mail.yourdomain.org</code> and <code>mail.yourdomain.org A {your VPS IP}</code>
</li>
<li>SPF <code>yourdomain.org TXT "v=spf1 a mx a:yourdomain.org ip4:{your VPS IP} ?all"</code>
</li>
<li>DKIM: Visit Email Messages &gt; DomainKeys Identified Mail in Virtualmin. Set 'Reject incoming email with invalid DKIM signature?' to 'No' and enter yourdomain.org to 'Additional domains to sign for'. Then add the record under 'DNS records for additional domains'.</li>
</ul><h3>
<a name="5-rake-tasks" class="anchor" href="#5-rake-tasks"><span class="octicon octicon-link"></span></a>5. Rake tasks</h3>

<p>Run <code>heroku run rake languages:default[English,en]</code> to set a default language and <code>heroku run rake mi:create_indexes</code> to create the database indexes. Open the Scheduler add-on with <code>heroku addons:open scheduler</code> and add the following tasks:</p>

<pre><code>rake news:update 7am
rake digests:daily 7.30am
rake digests:weekly 11pm (only runs on Sunday)
rake cleanup 4am
</code></pre>

<h3>
<a name="6-configuration" class="anchor" href="#6-configuration"><span class="octicon octicon-link"></span></a>6. Configuration</h3>

<p>Visit <a href="http://www.yourdomain.org">www.yourdomain.org</a> and change the admin name, email address and password. Click 'Lumen configuration' and complete the configuration. You're done!</p>

<h2>
<a name="switching-mail-servers" class="anchor" href="#switching-mail-servers"><span class="octicon octicon-link"></span></a>Switching mail servers</h2>

<p>If you switch your mail server, you'll need to re-setup the group mail accounts on the new server. Fire up a console (<code>heroku run bash; padrino c</code>) and run:</p>

<pre><code>Group.all.each { |g| g.setup_mail_accounts_and_forwarder }
ConversationPost.all.each { |c| c.update_attribute(:mid, nil) }
</code></pre>

<h2>
<a name="gallery" class="anchor" href="#gallery"><span class="octicon octicon-link"></span></a> Gallery</h2>

<h3>
<a name="homepage-amalgamates-newsfeeds-from-all-groups" class="anchor" href="#homepage-amalgamates-newsfeeds-from-all-groups"><span class="octicon octicon-link"></span></a>Homepage (amalgamates newsfeeds from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/home.jpg"><img src="http://wordsandwriting.github.io/lumen/images/home.jpg"></a></p>

<h3>
<a name="home-calendar-amalgamates-events-from-all-groups" class="anchor" href="#home-calendar-amalgamates-events-from-all-groups"><span class="octicon octicon-link"></span></a>Home calendar (amalgamates events from all groups)</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/calendar.jpg"><img src="http://wordsandwriting.github.io/lumen/images/calendar.jpg"></a></p>

<h3>
<a name="a-group" class="anchor" href="#a-group"><span class="octicon octicon-link"></span></a>A group</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/group.jpg"><img src="http://wordsandwriting.github.io/lumen/images/group.jpg"></a></p>

<h3>
<a name="a-group-digest" class="anchor" href="#a-group-digest"><span class="octicon octicon-link"></span></a>A group digest</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/digest.jpg"><img src="http://wordsandwriting.github.io/lumen/images/digest.jpg"></a></p>

<h3>
<a name="a-groups-map" class="anchor" href="#a-groups-map"><span class="octicon octicon-link"></span></a>A group's map</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/map.jpg"><img src="http://wordsandwriting.github.io/lumen/images/map.jpg"></a></p>

<h3>
<a name="a-profile" class="anchor" href="#a-profile"><span class="octicon octicon-link"></span></a>A profile</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/profile.jpg"><img src="http://wordsandwriting.github.io/lumen/images/profile.jpg"></a></p>

<h3>
<a name="email-accounts-on-virtualmin-corresponding-to-groups" class="anchor" href="#email-accounts-on-virtualmin-corresponding-to-groups"><span class="octicon octicon-link"></span></a>Email accounts on Virtualmin corresponding to groups</h3>

<p><a href="http://wordsandwriting.github.io/lumen/images/virtualmin.jpg"><img src="http://wordsandwriting.github.io/lumen/images/virtualmin.jpg"></a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/wordsandwriting">wordsandwriting</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>